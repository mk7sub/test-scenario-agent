from __future__ import annotations

SYSTEM_DESCRIPTION = """
対象システムはフードコートの呼び出し・順番待ちで使用される画面表示系アプリケーションです。
ログと画面表示の動きは常に一致している前提とします。

【ステータス】
- 受付済み
- 仕掛中
- 完了

【処理の流れ】
1. 受付・採番
2. 表示（お待ち番号）: ステータスが「受付済み」「仕掛中」の一覧を表示
3. 調理完了
4. 表示（呼び出し番号）: ステータスが「完了」の一覧を表示
5. お渡し完了

【重要な制約】
- ステータスは必ず「受付済み」→「仕掛中」→「完了」の順番で遷移しなければならない。
- 順番が逆行したり、飛び越えたり、ステップを飛ばしている場合は不正な遷移とみなす。
- ただし、ステータス遷移が途中で終わっているものは許容される（例: 「受付済み」のまま完了していない）。
- ログにエラーや例外が出力されている場合は、テスト結果をPASSと判定してはいけない。
""".strip()

ANALYSIS_INSTRUCTION = """
以下は1件のテストケースに対応するアプリケーションログです。
このログだけを根拠に、テストが期待通りに動作しているかどうかを判定してください。

特に次の点を厳密に確認してください:
1. ログにエラーや例外（"ERROR", "Exception", スタックトレースなど）が含まれていないか。
   → 含まれている場合は必ずFAILと判定すること。
2. ステータスの遷移順が「受付済み」→「仕掛中」→「完了」の順番を守っているか。
   → 順番の入れ替わり、逆行、ステータスの飛び越え・欠落があればFAILと判定すること。
   → 途中でステータス遷移が止まっている場合（例: 「受付済み」のまま完了していない）は許容される。

出力フォーマット:
1行目に必ず次のどちらかのみを出力してください:
- "結果: PASS"  (期待通りに動作している場合)
- "結果: FAIL"  (上記のどちらかに違反している場合)

2行目以降に、日本語で簡潔に理由を説明してください。
""".strip()


def build_analysis_prompt(log_text: str) -> str:
    return f"{SYSTEM_DESCRIPTION}\n\n{ANALYSIS_INSTRUCTION}\n\n--- ログ開始 ---\n{log_text}\n--- ログ終了 ---"


__all__ = [
    "ANALYSIS_INSTRUCTION",
    "SYSTEM_DESCRIPTION",
    "build_analysis_prompt",
]
